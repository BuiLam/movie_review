
<main class="main-content">
  <div class="container">
    <div class="page">
      <div class="content">
        <div class="row">
          <div class="col-md-4">
            <%= render "movies/search_form" %>
          </div>
          <div class="col-md-8">
            <div style="background-color: #e1e2e3; border-radius: 4px;">
              <center>映画情報</center>
            </div>
            <br>
            <figure class="movie-poster">
              <%= image_tag (@movie.picture.url) %>
            </figure>
            <div class="movie-title">
              <i class="fa fa-film" aria-hidden="true"></i>
              <%= @movie.name %></div>
            <ul class="movie-meta">

              <li>
                <i class="fa fa-calendar" aria-hidden="true"></i>
                <strong>公開日：</strong> <%= (@movie.date) %>
              </li>
              <li>
                <i class="fa fa-circle-o" aria-hidden="true"></i>
                <strong>平均評価:</strong>
                <div class="star-rating" title="">
                  <span id="all-star" style="width:70%" ></span>
                </div>
                <span id="all-rate" > 4/5</span>
              </li>

              <ul class="starring">
                <li><strong>キャスト:</strong>
                  <% @movie.actors.each do |actor| %>
                    <br><span>・ <%= actor.name %></span>
                  <% end %>
                </li>
              </ul>
              <div style="background-color: #e1e2e3; border-radius: 4px;">
                <center>解説</center>
              </div>
              <div class="movie-summary">
                <p><%= @movie.info %></p>
              </div>

              <div style="background-color: #e1e2e3; border-radius: 4px;">
                <center>映画レビュー</center>
              </div>
              <br>

            </ul>

            <!-- comment  -->
            <div class="panel panel-white post panel-shadow">
              <div class="post-heading">
                <div class="pull-left image">
                  <img src="http://bootdey.com/img/Content/user_1.jpg" class="img-circle avatar" alt="user profile image">
                </div>
                <div class="pull-left meta">
                  <div class="title h5">
                    <a href="#"><b>Nguyen Dang Hai</b></a>
                    made a post.
                  </div>
                  <h6 class="text-muted time">1 minute ago</h6>
                </div>
                <div class="pull-right meta">
                  <section class="rating-widget">
                        <!-- Rating Stars Box -->
                        <div class="rating-stars text-center">
                          <ul >
                            <li class="star selected" title="Poor" data-value="1">
                              <i class="fa fa-star fa-fw"></i>
                            </li>
                            <li class="star selected" title="Fair" data-value="2">
                              <i class="fa fa-star fa-fw"></i>
                            </li>
                            <li class="star selected" title="Good" data-value="3">
                              <i class="fa fa-star fa-fw"></i>
                            </li>
                            <li class="star selected" title="Excellent" data-value="4">
                              <i class="fa fa-star fa-fw"></i>
                            </li>
                            <li class="star" title="WOW!!!" data-value="5">
                              <i class="fa fa-star fa-fw"></i>
                            </li>
                          </ul>
                        </div>
                      </section>

                </div>
              </div>
              <div class="post-description">

                <p>Bootdey is a gallery of free snippets resources templates and utilities for bootstrap css hmtl js
                  framework. Codes for developers and web designers</p>
                <div class="stats">
                  <a href="#" class="btn btn-default stat-item">
                    <i class="fa fa-thumbs-up icon"></i>2
                  </a>
                  <a href="#" class="btn btn-default stat-item">
                    <i class="fa fa-thumbs-down icon"></i>12
                  </a>
                </div>
              </div>
            </div>

            <!-- end comment -->
            <div class="panel panel-white post panel-shadow">
              <div class="post-heading">
                <div class="pull-left image">
                  <img src="http://bootdey.com/img/Content/user_1.jpg" class="img-circle avatar" alt="user profile image">
                </div>
                <div class="pull-left meta">
                  <div class="title h5">
                    <a href="#"><b>Nguyen Dang Hai</b></a>
                    made a post.
                  </div>
                  <h6 class="text-muted time">1 minute ago</h6>

                </div>
                <div class="pull-right meta">
                  <section class='rating-widget'>
                        <!-- Rating Stars Box -->
                        <div class='rating-stars text-center'>
                          <ul id='stars'>
                            <li class='star' title='Poor' data-value='1'>
                              <i class='fa fa-star fa-fw'></i>
                            </li>
                            <li class='star' title='Fair' data-value='2'>
                              <i class='fa fa-star fa-fw'></i>
                            </li>
                            <li class='star' title='Good' data-value='3'>
                              <i class='fa fa-star fa-fw'></i>
                            </li>
                            <li class='star' title='Excellent' data-value='4'>
                              <i class='fa fa-star fa-fw'></i>
                            </li>
                            <li class='star' title='WOW!!!' data-value='5'>
                              <i class='fa fa-star fa-fw'></i>
                            </li>
                          </ul>
                        </div>
                      </section>

                </div>
              </div>
              <div class="">
                <!-- write comment  -->
                <form id="cmnt">
                  <fieldset>
                    <div class="form_grp">

                      <textarea id="userCmnt" placeholder="Write your comment here. You can Edit and Delete options. Just Hover in Your comment, you see the both buttons" style="border-width: 2px;"></textarea>
                      <input type="hidden" id="user_id" value="<%= current_user.id%>">
                      <input type="hidden" id="movie_id" value="<%= @movie.id %>">
                    </div>
                    <div class="form_grp">
                    <button type="button" id="submit">Submit</button>
                    </div>
                  </fieldset>
                </form>
                <!-- write comment  -->
              </div>
            </div>
            <!-- end comment -->
            <div class="wrapper">
              <div class="commentBoxfloat">

              </div>

                <div id="cmntContr">
                  sdafasd
                </div>


            </div>
          </div>
        </div> <!-- .row -->

      </div>
    </div>
  </div> <!-- .container -->
</main>


 <script type="text/javascript">
  var starCount = 0;
  var starString = "";
   $(function(){
  var inDexValue;

    $('button').click( function() {
      if($('#userCmnt').val().length == ''){
       alert('Please Enter Your Comment');
       return true;
      }
      var userCmnt = $('#userCmnt').val();
      var userId = $('#user_id').val();
      var movieId = $('#movie_id').val();

      if($('#submit').hasClass('editNow')){

        $('#cmntContr>div.viewCmnt').eq(inDexValue).children('p').html(userCmnt);

      }else{

        var str = "<div class=\"panel panel-white post panel-shadow\">"+
              "<div class=\"post-heading\">"
                +"<div class=\"pull-left image\">"
                  +"<img src=\"http://bootdey.com/img/Content/user_1.jpg\" class=\"img-circle avatar\" alt=\"user profile image\">"
                +"</div>"
                +"<div class=\"pull-left meta\">"
                  +"<div class=\"title h5\">"
                    +"<a href=\"#\"><b>Nguyen Dang Hai</b></a>"
                    +"made a post."
                  +"</div>"
                  +"<h6 class=\"text-muted time\">1 minute ago</h6>"
                +"</div>"
                + starString
             +" </div>"
              +"<div class=\"post-description\">"
                +"<p> "+userCmnt+" </p>"
                +"<div class=\"stats\">"
                  +"<a href=\"#\" class=\"btn btn-default stat-item\">"
                    +"<i class=\"fa fa-thumbs-up icon\"></i>2"
                  +"</a>"
                  +"<a href=\"#\" class=\"btn btn-default stat-item\">"
                    +"<i class=\"fa fa-thumbs-down icon\"></i>12"
                  +"</a>"
                +"</div>"
              +"</div>"
            +"</div>";


        $('#cmntContr').append(str);

        const WEB_PATH = "http://gtm2018.herokuapp.com";
        const LOCAL_PATH = "http://0.0.0.0:3000";
        const URL_TEST = LOCAL_PATH;
        var xhttp = new XMLHttpRequest();
        var url = URL_TEST+'/add_review?review[movie_id]='+movieId+'&review[user_id]='+userId+'&review[content]='+userCmnt+'&review[rate]='+starCount;
        xhttp.open('GET', url, true);
        xhttp.send();
      }
      $('#userCmnt').val('');
      $(this).removeClass('editNow');
  });

  // Delete
  $('#cmntContr').on('click', '.delete', function(){
    confirm("Delete Coformation");
    $(this).parent().remove();
  });
  // Edit
  $('#cmntContr').on('click', '.edit', function(){

    var toEdit = $(this).prev('p').html();
    //alert(toEdit);
    $('#userCmnt').val(toEdit);
    $('button').addClass('editNow');
    inDexValue = $(this).parent('div.viewCmnt').index();

  });
  });

 </script>
 <style type="text/css">
   *{
  margin:0;
  padding:0;
  box-sizing:border-box;
  border:0;
}
body{
  font: 13px/100% tahoma;
  }
.clear{clear:both;}
.wrapper{
  /*width:400px;*/
  margin:10px auto;
}
.commentBox{

}
fieldset{
  padding:10px;
  /*background:#69bdf4;*/
}
.form_grp{
  margin-bottom:10px;
}
textarea{
  width:100%;
  height:100px;
  padding:10px;
  border:1px solid #eee;
  resize:none;
}
button{
  padding:5px 20px;
  background-color:#0e7ec7;
  color:#fff;
  float:right;
}
.viewCmnt{
  clear:both;
  overflow:hidden;
  position:relative;
  background:#c8e7fb;
  border-bottom:1px solid #A6DAFC;
}
.viewCmnt p {
  width:100%;
  float:left;
  padding:10px;
  font-size:14px;
  line-height:20px;
  }
.edit, .delete{
  position:absolute;
  width:20px;
  height:20px;
  display:none;
  cursor:pointer;
  bottom:5px;
  padding:2px;
   }
.viewCmnt:hover .edit, .viewCmnt:hover .delete{
  display:block;
}
.edit{
  right:26px;  background:url(https://cdn4.iconfinder.com/data/icons/miu/22/editor_pencil_pen_edit_write_-16.png) no-repeat center #0e7ec7;
}
.delete{
  right:5px;
  background:url(https://cdn2.iconfinder.com/data/icons/flat-ui-icons-24-px/24/cross-24-16.png) no-repeat center #0e7ec7;
  z-index:2;
}
 </style>


 <style type="text/css">


/* Rating Star Widgets Style */
.rating-stars ul {
  list-style-type:none;
  padding:0;

  -moz-user-select:none;
  -webkit-user-select:none;
}
.rating-stars ul > li.star {
  display:inline-block;

}

/* Idle State of the stars */
.rating-stars ul > li.star > i.fa {
  font-size:2em; /* Change the size of the stars */
  color:#ccc; /* Color on idle state */
}

/* Hover state of the stars */
.rating-stars ul > li.star.hover > i.fa {
  color:#FFCC36;
}

/* Selected state of the stars */
.rating-stars ul > li.star.selected > i.fa {
  color:#FF912C;
}

 </style>

 <script type="text/javascript">
   $(document).ready(function(){

  /* 1. Visualizing things on Hover - See next part for action on click */
  $('#stars li').on('mouseover', function(){
    var onStar = parseInt($(this).data('value'), 10); // The star currently mouse on

    // Now highlight all the stars that's not after the current hovered star
    $(this).parent().children('li.star').each(function(e){
      if (e < onStar) {
        $(this).addClass('hover');
      }
      else {
        $(this).removeClass('hover');
      }
    });

  }).on('mouseout', function(){
    $(this).parent().children('li.star').each(function(e){
      $(this).removeClass('hover');
    });
  });


  /* 2. Action to perform on click */
  $('#stars li').on('click', function(){
    var onStar = parseInt($(this).data('value'), 10); // The star currently selected
    // alert("selected "+onStar);
    starCount = onStar;
    var stars = $(this).parent().children('li.star');

    for (i = 0; i < stars.length; i++) {
      $(stars[i]).removeClass('selected');
    }

    for (i = 0; i < onStar; i++) {
      $(stars[i]).addClass('selected');
    }

    starString = "";
    starString= "<div class=\"pull-right meta\">"
                  +"<section class=\"rating-widget\">"
                        +"<div class=\"rating-stars text-center\">"
                          +"<ul >";
    for (i=1;i<= 5 ;i++) {
      if (i<= starCount) {
                            starString = starString +"<li class=\"star selected\" title=\"Poor\" data-value=\""+i+"\">"
                              +"<i class=\"fa fa-star fa-fw\"></i>"
                            +"</li>";
                            }
                            else {
                            starString = starString +"<li class=\"star\" title=\"WOW!!!\" data-value=\""+i+"\">"
                              +"<i class=\"fa fa-star fa-fw\"></i>"
                            +"";
                          }
                          }
                          starString = starString + "</ul>"
                       +" </div>"
                      +"</section>"
                +"</div>";
    // alert(starString);
    $('#all-star').css("width", "30%");
    $('#all-rate').text("rate: "+ 4/5);
  });


});


function responseMessage(msg) {
  $('.success-box').fadeIn(200);
  $('.success-box div.text-message').html("<span>" + msg + "</span>");
}
 </script>
